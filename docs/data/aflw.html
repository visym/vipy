<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.11.6" />
<meta name="google-site-verification" content="aB8LkQegj94_TJPdrcJm2ldIRWyXY82Jp24Gtkdgyn0" />
<title>vipy.data.aflw API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>vipy.data.aflw</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L1-L112" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import os
import sqlite3
import csv
from vipy.util import remkdir
from vipy.image import ImageDetection
import numpy as np


SCHEMA = [&#39;FILENAME&#39;, &#39;FACE_X&#39;, &#39;FACE_Y&#39;, &#39;FACE_WIDTH&#39;, &#39;FACE_HEIGHT&#39;,
          &#39;LeftBrowLeftCorner_X&#39;, &#39;LeftBrowLeftCorner_Y&#39;, &#39;LeftBrowCenter_X&#39;, &#39;LeftBrowCenter_Y&#39;, &#39;LeftBrowRightCorner_X&#39;, &#39;LeftBrowRightCorner_Y&#39;,
          &#39;RightBrowLeftCorner_X&#39;, &#39;RightBrowLeftCorner_Y&#39;, &#39;RightBrowCenter_X&#39;, &#39;RightBrowCenter_Y&#39;, &#39;RightBrowRightCorner_X&#39;, &#39;RightBrowRightCorner_Y&#39;,
          &#39;LeftEyeLeftCorner_X&#39;, &#39;LeftEyeLeftCorner_Y&#39;, &#39;LeftEyeCenter_X&#39;, &#39;LeftEyeCenter_Y&#39;, &#39;LeftEyeRightCorner_X&#39;, &#39;LeftEyeRightCorner_Y&#39;,
          &#39;RightEyeLeftCorner_X&#39;, &#39;RightEyeLeftCorner_Y&#39;, &#39;RightEyeCenter_X&#39;, &#39;RightEyeCenter_Y&#39;, &#39;RightEyeRightCorner_X&#39;, &#39;RightEyeRightCorner_Y&#39;,
          &#39;LeftEar_X&#39;, &#39;LeftEar_Y&#39;, &#39;NoseLeft_X&#39;, &#39;NoseLeft_Y&#39;, &#39;NoseCenter_X&#39;, &#39;NoseCenter_Y&#39;, &#39;NoseRight_X&#39;, &#39;NoseRight_Y&#39;,
          &#39;RightEar_X&#39;, &#39;RightEar_Y&#39;, &#39;MouthLeftCorner_X&#39;, &#39;MouthLeftCorner_Y&#39;, &#39;MouthCenter_X&#39;, &#39;MouthCenter_Y&#39;, &#39;MouthRightCorner_X&#39;, &#39;MouthRightCorner_Y&#39;,
          &#39;ChinCenter_X&#39;, &#39;ChinCenter_Y&#39;]

LANDMARKS_3D = np.array([[-57.0899, 37.2398, 47.1156],
                         [-39.2328, 43.6173, 59.8098],
                         [-16.9114, 36.602, 65.2735],
                         [15.6142, 36.602, 65.2664],
                         [38.5733, 42.9796, 60.1435],
                         [55.7927, 37.2398, 49.5446],
                         [-50.0746, 20.6582, 48.3683],
                         [-34.1307, 21.9337, 56.6652],
                         [-19.4624, 18.7449, 53.8703],
                         [19.4407, 18.7449, 53.8993],
                         [33.4713, 21.2959, 56.124],
                         [46.8642, 21.2959, 50.6618],
                         [-76.2226, -26.5357, -12.6367],
                         [-17.5491, -23.9847, 68.4396],
                         [0.308036, -15.0561, 90.3836],
                         [18.8029, -25.898, 65.7138],
                         [78.1142, -27.1735, -16.2555],
                         [-28.3909, -53.3214, 58.766],
                         [-0.329719, -54.5969, 72.568],
                         [28.3693, -53.9592, 58.5929],
                         [-0.967474, -96.051, 63.4542]])


class AFLW(object):
    def __init__(self, datadir):
        self.datadir = remkdir(datadir)
        if not os.path.isdir(os.path.join(self.datadir)):
            raise ValueError(&#39;Download AFLW dataset manually to &#34;%s&#34; &#39; % self.datadir)

    def __repr__(self):
        return str(&#39;&lt;vipy.data.aflw: %s&gt;&#39; % self.datadir)

    def dataset(self):
        csvfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
        with open(csvfile, &#39;r&#39;) as f:
            for x in f.readline().split(&#39;,&#39;):
                if x[0][0] != &#39;#&#39;:
                    im = ImageDetection(filename=os.path.join(self.datadir, x[0]), category=&#39;face&#39;,
                                        xmin=float(x[1]) if len(x[1]) &gt; 0 else float(&#39;nan&#39;),
                                        ymin=float(x[2]) if len(x[2]) &gt; 0 else float(&#39;nan&#39;),
                                        xmax=float(x[1]) + float(x[3]) if ((len(x[1]) &gt; 0) and (len(x[3]) &gt; 0)) else float(&#39;nan&#39;),
                                        ymax=float(x[2]) + float(x[4]) if ((len(x[2]) &gt; 0) and (len(x[4]) &gt; 0)) else float(&#39;nan&#39;),
                                        attributes={k:v for (k,v) in zip(SCHEMA,x)})  # Parse row
                    yield im

    def export(self):
        &#34;&#34;&#34;Export sqlite database file to aflw.csv&#34;&#34;&#34;
        dbfile = os.path.join(self.datadir, &#39;data&#39;, &#39;aflw.sqlite&#39;)
        db = sqlite3.connect(dbfile)
        cursor = db.cursor()

        outfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
        with open(outfile, &#39;wb&#39;) as csvfile:
            f = csv.writer(csvfile, delimiter=&#39;,&#39;, quotechar=&#39;|&#39;, quoting=csv.QUOTE_MINIMAL)
            f.writerow([s if k &gt; 0 else &#39;#&#39; + s for (k,s) in enumerate(SCHEMA)])  # comment first line
            faceidQuery = cursor.execute(&#39;SELECT face_id FROM Faces&#39;).fetchall()
            for faceid in faceidQuery:
                faceid = faceid[0]
                fileidQuery = cursor.execute(&#39;SELECT file_id FROM Faces WHERE face_id = &#34;%s&#34;&#39; % str(faceid))
                fileid = str(fileidQuery.fetchone()[0])

                imgDataQuery = cursor.execute(&#39;SELECT db_id,filepath,width,height FROM FaceImages where file_id = &#34;%s&#34;&#39; % str(fileid))
                imgData = imgDataQuery.fetchall()

                facerect = cursor.execute(&#39;SELECT x,y,w,h FROM FaceRect WHERE face_id = &#34;%s&#34;&#39; % str(faceid)).fetchone()

                ptsQuery = cursor.execute(&#39;SELECT descr,FeatureCoords.x,FeatureCoords.y FROM FeatureCoords,FeatureCoordTypes WHERE face_id = &#34;%s&#34; AND FeatureCoords.feature_id = FeatureCoordTypes.feature_id&#39; % (str(faceid))).fetchall()
                annoDict = {}
                for pts in ptsQuery:
                    annoDict[&#39;%s_X&#39; % str(pts[0])] = pts[1]
                    annoDict[&#39;%s_Y&#39; % str(pts[0])] = pts[2]

                annoDict[&#39;FILENAME&#39;] = os.path.join(&#39;data&#39;,&#39;flickr&#39;, imgData[0][1])
                annoDict[&#39;FACE_X&#39;] = facerect[0]
                annoDict[&#39;FACE_Y&#39;] = facerect[1]
                annoDict[&#39;FACE_WIDTH&#39;] = facerect[2]
                annoDict[&#39;FACE_HEIGHT&#39;] = facerect[3]

                row = [annoDict[key] if key in annoDict.keys() else &#39;&#39; for key in SCHEMA]
                print(&#39;[vipy.data.aflw]: exporting %d points for face &#34;%s&#34; &#39; % (len(ptsQuery), faceid))
                f.writerow(row)

        db.close()
        return self


def landmarks(im):
    &#34;&#34;&#34;Return 21x2 frame array of landmark positions in 1-21 order, NaN if occluded&#34;&#34;&#34;
    return np.float32(np.array([im.attributes[key] if len(im.attributes[key]) &gt; 0 else np.float32(&#39;nan&#39;) for key in SCHEMA[5:]])).reshape(21, 2)


def eyes_nose_chin(self, im):
    &#34;&#34;&#34;Return 4x2 frame array of left eye, right eye nose chin&#34;&#34;&#34;
    fr = landmarks(im)
    return fr[[8 - 1, 11 - 1, 15 - 1, 21 - 1],:]  # left eye center, right eye center, nose center  (AFLW annotation, 1-indexed)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="vipy.data.aflw.eyes_nose_chin"><code class="name flex">
<span>def <span class="ident">eyes_nose_chin</span></span>(<span>self, im)</span>
</code></dt>
<dd>
<div class="desc"><p>Return 4x2 frame array of left eye, right eye nose chin</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L109-L112" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def eyes_nose_chin(self, im):
    &#34;&#34;&#34;Return 4x2 frame array of left eye, right eye nose chin&#34;&#34;&#34;
    fr = landmarks(im)
    return fr[[8 - 1, 11 - 1, 15 - 1, 21 - 1],:]  # left eye center, right eye center, nose center  (AFLW annotation, 1-indexed)</code></pre>
</details>
</dd>
<dt id="vipy.data.aflw.landmarks"><code class="name flex">
<span>def <span class="ident">landmarks</span></span>(<span>im)</span>
</code></dt>
<dd>
<div class="desc"><p>Return 21x2 frame array of landmark positions in 1-21 order, NaN if occluded</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L104-L106" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def landmarks(im):
    &#34;&#34;&#34;Return 21x2 frame array of landmark positions in 1-21 order, NaN if occluded&#34;&#34;&#34;
    return np.float32(np.array([im.attributes[key] if len(im.attributes[key]) &gt; 0 else np.float32(&#39;nan&#39;) for key in SCHEMA[5:]])).reshape(21, 2)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="vipy.data.aflw.AFLW"><code class="flex name class">
<span>class <span class="ident">AFLW</span></span>
<span>(</span><span>datadir)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L41-L101" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class AFLW(object):
    def __init__(self, datadir):
        self.datadir = remkdir(datadir)
        if not os.path.isdir(os.path.join(self.datadir)):
            raise ValueError(&#39;Download AFLW dataset manually to &#34;%s&#34; &#39; % self.datadir)

    def __repr__(self):
        return str(&#39;&lt;vipy.data.aflw: %s&gt;&#39; % self.datadir)

    def dataset(self):
        csvfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
        with open(csvfile, &#39;r&#39;) as f:
            for x in f.readline().split(&#39;,&#39;):
                if x[0][0] != &#39;#&#39;:
                    im = ImageDetection(filename=os.path.join(self.datadir, x[0]), category=&#39;face&#39;,
                                        xmin=float(x[1]) if len(x[1]) &gt; 0 else float(&#39;nan&#39;),
                                        ymin=float(x[2]) if len(x[2]) &gt; 0 else float(&#39;nan&#39;),
                                        xmax=float(x[1]) + float(x[3]) if ((len(x[1]) &gt; 0) and (len(x[3]) &gt; 0)) else float(&#39;nan&#39;),
                                        ymax=float(x[2]) + float(x[4]) if ((len(x[2]) &gt; 0) and (len(x[4]) &gt; 0)) else float(&#39;nan&#39;),
                                        attributes={k:v for (k,v) in zip(SCHEMA,x)})  # Parse row
                    yield im

    def export(self):
        &#34;&#34;&#34;Export sqlite database file to aflw.csv&#34;&#34;&#34;
        dbfile = os.path.join(self.datadir, &#39;data&#39;, &#39;aflw.sqlite&#39;)
        db = sqlite3.connect(dbfile)
        cursor = db.cursor()

        outfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
        with open(outfile, &#39;wb&#39;) as csvfile:
            f = csv.writer(csvfile, delimiter=&#39;,&#39;, quotechar=&#39;|&#39;, quoting=csv.QUOTE_MINIMAL)
            f.writerow([s if k &gt; 0 else &#39;#&#39; + s for (k,s) in enumerate(SCHEMA)])  # comment first line
            faceidQuery = cursor.execute(&#39;SELECT face_id FROM Faces&#39;).fetchall()
            for faceid in faceidQuery:
                faceid = faceid[0]
                fileidQuery = cursor.execute(&#39;SELECT file_id FROM Faces WHERE face_id = &#34;%s&#34;&#39; % str(faceid))
                fileid = str(fileidQuery.fetchone()[0])

                imgDataQuery = cursor.execute(&#39;SELECT db_id,filepath,width,height FROM FaceImages where file_id = &#34;%s&#34;&#39; % str(fileid))
                imgData = imgDataQuery.fetchall()

                facerect = cursor.execute(&#39;SELECT x,y,w,h FROM FaceRect WHERE face_id = &#34;%s&#34;&#39; % str(faceid)).fetchone()

                ptsQuery = cursor.execute(&#39;SELECT descr,FeatureCoords.x,FeatureCoords.y FROM FeatureCoords,FeatureCoordTypes WHERE face_id = &#34;%s&#34; AND FeatureCoords.feature_id = FeatureCoordTypes.feature_id&#39; % (str(faceid))).fetchall()
                annoDict = {}
                for pts in ptsQuery:
                    annoDict[&#39;%s_X&#39; % str(pts[0])] = pts[1]
                    annoDict[&#39;%s_Y&#39; % str(pts[0])] = pts[2]

                annoDict[&#39;FILENAME&#39;] = os.path.join(&#39;data&#39;,&#39;flickr&#39;, imgData[0][1])
                annoDict[&#39;FACE_X&#39;] = facerect[0]
                annoDict[&#39;FACE_Y&#39;] = facerect[1]
                annoDict[&#39;FACE_WIDTH&#39;] = facerect[2]
                annoDict[&#39;FACE_HEIGHT&#39;] = facerect[3]

                row = [annoDict[key] if key in annoDict.keys() else &#39;&#39; for key in SCHEMA]
                print(&#39;[vipy.data.aflw]: exporting %d points for face &#34;%s&#34; &#39; % (len(ptsQuery), faceid))
                f.writerow(row)

        db.close()
        return self</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="vipy.data.aflw.AFLW.dataset"><code class="name flex">
<span>def <span class="ident">dataset</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L50-L61" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def dataset(self):
    csvfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
    with open(csvfile, &#39;r&#39;) as f:
        for x in f.readline().split(&#39;,&#39;):
            if x[0][0] != &#39;#&#39;:
                im = ImageDetection(filename=os.path.join(self.datadir, x[0]), category=&#39;face&#39;,
                                    xmin=float(x[1]) if len(x[1]) &gt; 0 else float(&#39;nan&#39;),
                                    ymin=float(x[2]) if len(x[2]) &gt; 0 else float(&#39;nan&#39;),
                                    xmax=float(x[1]) + float(x[3]) if ((len(x[1]) &gt; 0) and (len(x[3]) &gt; 0)) else float(&#39;nan&#39;),
                                    ymax=float(x[2]) + float(x[4]) if ((len(x[2]) &gt; 0) and (len(x[4]) &gt; 0)) else float(&#39;nan&#39;),
                                    attributes={k:v for (k,v) in zip(SCHEMA,x)})  # Parse row
                yield im</code></pre>
</details>
</dd>
<dt id="vipy.data.aflw.AFLW.export"><code class="name flex">
<span>def <span class="ident">export</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Export sqlite database file to aflw.csv</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/vipy/blob/aeafa05f49d28db0926b8db763349138abc3f87a/vipy/data/aflw.py#L63-L101" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def export(self):
    &#34;&#34;&#34;Export sqlite database file to aflw.csv&#34;&#34;&#34;
    dbfile = os.path.join(self.datadir, &#39;data&#39;, &#39;aflw.sqlite&#39;)
    db = sqlite3.connect(dbfile)
    cursor = db.cursor()

    outfile = os.path.join(self.datadir, &#39;aflw.csv&#39;)
    with open(outfile, &#39;wb&#39;) as csvfile:
        f = csv.writer(csvfile, delimiter=&#39;,&#39;, quotechar=&#39;|&#39;, quoting=csv.QUOTE_MINIMAL)
        f.writerow([s if k &gt; 0 else &#39;#&#39; + s for (k,s) in enumerate(SCHEMA)])  # comment first line
        faceidQuery = cursor.execute(&#39;SELECT face_id FROM Faces&#39;).fetchall()
        for faceid in faceidQuery:
            faceid = faceid[0]
            fileidQuery = cursor.execute(&#39;SELECT file_id FROM Faces WHERE face_id = &#34;%s&#34;&#39; % str(faceid))
            fileid = str(fileidQuery.fetchone()[0])

            imgDataQuery = cursor.execute(&#39;SELECT db_id,filepath,width,height FROM FaceImages where file_id = &#34;%s&#34;&#39; % str(fileid))
            imgData = imgDataQuery.fetchall()

            facerect = cursor.execute(&#39;SELECT x,y,w,h FROM FaceRect WHERE face_id = &#34;%s&#34;&#39; % str(faceid)).fetchone()

            ptsQuery = cursor.execute(&#39;SELECT descr,FeatureCoords.x,FeatureCoords.y FROM FeatureCoords,FeatureCoordTypes WHERE face_id = &#34;%s&#34; AND FeatureCoords.feature_id = FeatureCoordTypes.feature_id&#39; % (str(faceid))).fetchall()
            annoDict = {}
            for pts in ptsQuery:
                annoDict[&#39;%s_X&#39; % str(pts[0])] = pts[1]
                annoDict[&#39;%s_Y&#39; % str(pts[0])] = pts[2]

            annoDict[&#39;FILENAME&#39;] = os.path.join(&#39;data&#39;,&#39;flickr&#39;, imgData[0][1])
            annoDict[&#39;FACE_X&#39;] = facerect[0]
            annoDict[&#39;FACE_Y&#39;] = facerect[1]
            annoDict[&#39;FACE_WIDTH&#39;] = facerect[2]
            annoDict[&#39;FACE_HEIGHT&#39;] = facerect[3]

            row = [annoDict[key] if key in annoDict.keys() else &#39;&#39; for key in SCHEMA]
            print(&#39;[vipy.data.aflw]: exporting %d points for face &#34;%s&#34; &#39; % (len(ptsQuery), faceid))
            f.writerow(row)

    db.close()
    return self</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="VIPY" href="https://github.com/visym/vipy/">
<img src="https://www.visym.com/labs/images/visym_logo_black_notext.png" alt="" width="60">
</a>
<h1 style="font-size:200%;"><b>VIPY:</b> Visual Dataset Transformation</h1>
</header>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '././doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="vipy.data" href="index.html">vipy.data</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="vipy.data.aflw.eyes_nose_chin" href="#vipy.data.aflw.eyes_nose_chin">eyes_nose_chin</a></code></li>
<li><code><a title="vipy.data.aflw.landmarks" href="#vipy.data.aflw.landmarks">landmarks</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="vipy.data.aflw.AFLW" href="#vipy.data.aflw.AFLW">AFLW</a></code></h4>
<ul class="">
<li><code><a title="vipy.data.aflw.AFLW.dataset" href="#vipy.data.aflw.AFLW.dataset">dataset</a></code></li>
<li><code><a title="vipy.data.aflw.AFLW.export" href="#vipy.data.aflw.AFLW.export">export</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
